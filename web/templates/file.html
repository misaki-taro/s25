{% extends 'layout/manage.html' %}

{% block css %}
    <style>
        .panel-default .panel-heading {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .panel-default > .panel-heading a {
            text-decoration: none;
        }

        .panel-default > .panel-heading span {
            padding: 0 5px;
        }

        .panel-default > .panel-heading .function .upload {
            overflow: hidden;
        }

        .panel-default > .panel-heading .function .upload input {
            opacity: 0;
            position: absolute;
            top: 0;
            bottom: 0;
            width: 76px;
            left: -2px;
            overflow: hidden;
        }

        .upload-progress {
            position: fixed;
            right: 2px;
            bottom: 2px;
            width: 400px;
        }

        .upload-progress .progress-error {
            color: red;
        }
    </style>
{% endblock %}

{% block content %}
  <div class="container-fluid">
    <div class="panel panel-default">
      <!-- Default panel contents -->
      <div class="panel-heading">
          <div>pannel headding</div>
          <div class="function">
            <a class="btn btn-success btn-xs" data-toggle="modal" data-target="#addModal" data-whatever="新建文件夹">
                <i class="fa fa-plus-circle" aria-hidden="true"></i> 新建文件夹
            </a>
        </div>
        </div>

      <!-- Table -->
      <table class="table">
        <thead>
          <tr>
            <th>名称</th>
            <th>文件大小</th>
            <th>更新者</th>
            <th>更新时间</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
        {% for item in file_object_list %}
          <tr>
              <td>
                {% if item.file_type == 1 %}
                    <i class="fa fa-file" aria-hidden="true"></i>
                    {{ item.name }}
                {% else %}
                    <a href="{% url 'web:manage:file' project_id=request.tracer.project.id %}?folder={{ item.id }}">
                        <i class="fa fa-folder" aria-hidden="true"></i>
                        {{ item.name }}
                    </a>
                {% endif %}
            </td>
              <td>
                {% if item.file_type == 1 %}
                    {{ item.file_size }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ item.update_user.username }}</td>
            <td>{{ item.update_datetime }}</td>
            <td>
                <a>编辑</a>
                <a>删除</a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"></h4>
            </div>
            <div class="modal-body">
                <form id="form">
                    {% csrf_token %}
                    <input class="hide" type="text" name="fid" id="fid">
                    {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                            {{ field }}
                            <span class="error-msg">{{ field.errors.0 }}</span>
                        </div>
                    {% endfor %}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                <button id="btnFormSubmit" type="button" class="btn btn-primary">确 定</button>
            </div>
        </div>
    </div>


{% endblock %}

{% block js %}
<script>
    $(function(){
        initAddModal();
        bindModelSubmit();
    });

    function initAddModal(){
        $('#addModal').on('show.bs.modal', function (event){
            var button = $(event.relatedTarget);
            var recipient = button.data('whatever');
            var modal = $(this);
            modal.find('.modal-title').text(recipient);
            modal.find('.error-msg').empty();

            $('#form')[0].reset();
        })
    }

    function bindModelSubmit(){
        $('#btnFormSubmit').click(function(){
            $.ajax({
                url: location.href,
                type: "POST",
                data: $('#form').serialize(),
                dataType: "JSON",
                success: function(res){
                    if(res.status){
                        // 刷新
                        location.href = location.href;
                    }else{
                        $.each(res.error, function(key, value){
                            $("#id_"+key).next().text(value[0])
                        })
                    }
                }
            })
        });
    }

</script>

{% endblock %}
